<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p355" style="overflow: hidden; position: relative; background-color: white; width: 790px; height: 1018px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_355{left:120px;bottom:945px;letter-spacing:0.14px;}
#t2_355{left:482px;bottom:945px;letter-spacing:0.07px;word-spacing:-0.22px;}
#t3_355{left:148px;bottom:891px;letter-spacing:-0.15px;}
#t4_355{left:148px;bottom:877px;letter-spacing:-0.11px;}
#t5_355{left:194px;bottom:877px;letter-spacing:-0.15px;}
#t6_355{left:148px;bottom:864px;letter-spacing:-0.15px;}
#t7_355{left:148px;bottom:850px;letter-spacing:-0.11px;}
#t8_355{left:194px;bottom:850px;letter-spacing:-0.15px;}
#t9_355{left:148px;bottom:836px;letter-spacing:-0.11px;}
#ta_355{left:221px;bottom:836px;letter-spacing:-0.15px;}
#tb_355{left:148px;bottom:822px;letter-spacing:-0.11px;}
#tc_355{left:194px;bottom:822px;}
#td_355{left:148px;bottom:809px;letter-spacing:-0.11px;}
#te_355{left:148px;bottom:795px;letter-spacing:-0.11px;}
#tf_355{left:194px;bottom:795px;letter-spacing:-0.15px;}
#tg_355{left:148px;bottom:781px;letter-spacing:-0.11px;}
#th_355{left:221px;bottom:781px;letter-spacing:-0.15px;}
#ti_355{left:148px;bottom:767px;letter-spacing:-0.11px;}
#tj_355{left:194px;bottom:767px;}
#tk_355{left:148px;bottom:754px;letter-spacing:-0.15px;}
#tl_355{left:148px;bottom:729px;letter-spacing:0.4px;word-spacing:-0.13px;}
#tm_355{left:376px;bottom:730px;letter-spacing:0.19px;}
#tn_355{left:421px;bottom:729px;letter-spacing:0.42px;}
#to_355{left:456px;bottom:730px;letter-spacing:0.19px;}
#tp_355{left:481px;bottom:729px;letter-spacing:0.38px;}
#tq_355{left:497px;bottom:730px;letter-spacing:0.19px;}
#tr_355{left:525px;bottom:729px;letter-spacing:0.41px;word-spacing:-0.15px;}
#ts_355{left:120px;bottom:711px;letter-spacing:0.42px;word-spacing:0.56px;}
#tt_355{left:120px;bottom:692px;letter-spacing:0.41px;word-spacing:1.17px;}
#tu_355{left:120px;bottom:674px;letter-spacing:0.34px;word-spacing:-0.06px;}
#tv_355{left:120px;bottom:656px;letter-spacing:0.42px;word-spacing:0.01px;}
#tw_355{left:148px;bottom:633px;letter-spacing:0.1px;word-spacing:-0.35px;}
#tx_355{left:120px;bottom:615px;letter-spacing:0.03px;word-spacing:-0.36px;}
#ty_355{left:120px;bottom:596px;letter-spacing:0.1px;}
#tz_355{left:148px;bottom:573px;letter-spacing:0.09px;word-spacing:0.01px;}
#t10_355{left:131px;bottom:540px;}
#t11_355{left:148px;bottom:541px;letter-spacing:0.1px;word-spacing:-0.06px;}
#t12_355{left:148px;bottom:523px;letter-spacing:0.1px;word-spacing:0.02px;}
#t13_355{left:148px;bottom:505px;letter-spacing:0.1px;word-spacing:-0.04px;}
#t14_355{left:148px;bottom:486px;letter-spacing:0.09px;word-spacing:0.03px;}
#t15_355{left:148px;bottom:468px;letter-spacing:0.03px;word-spacing:0.08px;}
#t16_355{left:131px;bottom:443px;}
#t17_355{left:148px;bottom:443px;letter-spacing:0.09px;word-spacing:-0.33px;}
#t18_355{left:148px;bottom:425px;letter-spacing:0.05px;word-spacing:0.06px;}
#t19_355{left:334px;bottom:426px;letter-spacing:-0.15px;}
#t1a_355{left:360px;bottom:425px;letter-spacing:0.11px;}
#t1b_355{left:148px;bottom:407px;letter-spacing:0.1px;word-spacing:0.01px;}
#t1c_355{left:148px;bottom:388px;letter-spacing:0.06px;word-spacing:0.06px;}
#t1d_355{left:131px;bottom:363px;}
#t1e_355{left:148px;bottom:364px;letter-spacing:0.1px;word-spacing:-0.05px;}
#t1f_355{left:148px;bottom:346px;letter-spacing:0.1px;word-spacing:-0.1px;}
#t1g_355{left:148px;bottom:327px;letter-spacing:0.11px;word-spacing:-0.01px;}
#t1h_355{left:148px;bottom:295px;letter-spacing:0.1px;word-spacing:0.01px;}
#t1i_355{left:366px;bottom:296px;letter-spacing:-0.15px;}
#t1j_355{left:426px;bottom:295px;}
#t1k_355{left:128px;bottom:265px;letter-spacing:0.16px;}
#t1l_355{left:254px;bottom:265px;letter-spacing:0.12px;}
#t1m_355{left:565px;bottom:265px;letter-spacing:0.11px;}
#t1n_355{left:565px;bottom:246px;letter-spacing:0.12px;word-spacing:-1.3px;}
#t1o_355{left:128px;bottom:224px;letter-spacing:-0.15px;}
#t1p_355{left:254px;bottom:222px;letter-spacing:0.1px;word-spacing:2.78px;}
#t1q_355{left:254px;bottom:204px;letter-spacing:0.08px;word-spacing:0.52px;}
#t1r_355{left:441px;bottom:204px;letter-spacing:0.17px;}
#t1s_355{left:470px;bottom:204px;letter-spacing:0.14px;word-spacing:0.45px;}
#t1t_355{left:254px;bottom:185px;letter-spacing:0.1px;word-spacing:8.03px;}
#t1u_355{left:254px;bottom:167px;letter-spacing:0.09px;word-spacing:0.74px;}
#t1v_355{left:499px;bottom:168px;letter-spacing:-0.15px;}
#t1w_355{left:545px;bottom:167px;}
#t1x_355{left:254px;bottom:149px;letter-spacing:0.08px;word-spacing:1.77px;}
#t1y_355{left:254px;bottom:130px;letter-spacing:0.1px;word-spacing:3.93px;}
#t1z_355{left:254px;bottom:112px;letter-spacing:0.05px;word-spacing:3.02px;}
#t20_355{left:254px;bottom:94px;letter-spacing:0.13px;}
#t21_355{left:565px;bottom:224px;letter-spacing:-0.15px;}

.s1_355{font-size:15px;font-family:TimesNewRomanPS_12k;color:#2D2D2D;}
.s2_355{font-size:15px;font-family:TimesNewRomanPS-Bold_12g;color:#2D2D2D;}
.s3_355{font-size:14px;font-family:Courier_12t;color:#2D2D2D;}
.s4_355{font-size:17px;font-family:TimesNewRomanPS-Bold_12g;color:#2D2D2D;}
.s5_355{font-size:14px;font-family:Courier-Bold_12r;color:#2D2D2D;}
.s6_355{font-size:15px;font-family:Courier-Bold_12r;color:#2D2D2D;}
.t.v0_355{transform:scaleX(0.8);}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts355" type="text/css" >

@font-face {
	font-family: Courier-Bold_12r;
	src: url("fonts/Courier-Bold_12r.woff") format("woff");
}

@font-face {
	font-family: Courier_12t;
	src: url("fonts/Courier_12t.woff") format("woff");
}

@font-face {
	font-family: TimesNewRomanPS-Bold_12g;
	src: url("fonts/TimesNewRomanPS-Bold_12g.woff") format("woff");
}

@font-face {
	font-family: TimesNewRomanPS_12k;
	src: url("fonts/TimesNewRomanPS_12k.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg355Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg355" style="-webkit-user-select: none;"><svg id="pdf355" width="790" height="1018" viewBox="0 0 790 1018" style="width:790px; height:1018px; -moz-transform:scale(1); z-index: 0; isolation: isolate;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
<clipPath id="c0_355"><path d="M-1.6,1017.1V-.1H792.5V1017.1Z"/></clipPath>
<style type="text/css"><![CDATA[
.g0_355{
fill: none;
stroke: #2D2D2D;
stroke-width: 0.763;
stroke-miterlimit: 10;
}
.g1_355{
fill: none;
stroke: #FFF;
stroke-width: 1.145;
stroke-miterlimit: 10;
}
.g2_355{
fill: none;
stroke: #222;
stroke-width: 0.381;
stroke-miterlimit: 10;
}
]]></style>
</defs>
<path d="M119.9,730.6V926.9m126,-197.1V927.6M556.8,729.8V927.6m113.8,-197V926.9M119.5,730.2H671M119.5,774.5H671M119.5,927.3H671" class="g0_355"/>
<g clip-path="url(#c0_355)">
<path d="M-58.2,1.4h55m-55,1017.5h55m797.4,0h55M794.2,1.4h55M10.4,-67.2v55m770,-55v55m0,1044.9v55m-770,-55v55" class="g1_355"/>
<path d="M-58.2,1.4h55m-55,1017.5h55m797.4,0h55M794.2,1.4h55M10.4,-67.2v55m770,-55v55m0,1044.9v55m-770,-55v55M-7.8,510.2c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5,4.1,9.1,9.1,9.1c5.1,0,9.2,-4.1,9.2,-9.1Zm-36.7,0H-3.2M-17,473.5v73.3M817,510.2c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5,4.1,9.1,9.1,9.1c5.1,0,9.2,-4.1,9.2,-9.1Zm-22.8,0h41.2M807.9,473.5v73.3M-7.8,19.8c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5,4.1,9.1,9.1,9.1c5.1,0,9.2,-4.1,9.2,-9.1Zm-36.7,0H-3.2M-17,6V56.4m9.2,944.2c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5.1,4.1,9.2,9.1,9.2c5.1,0,9.2,-4.1,9.2,-9.2Zm-36.7,0H-3.2M-17,963.9v50.4M817,19.8c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5,4.1,9.1,9.1,9.1c5.1,0,9.2,-4.1,9.2,-9.1Zm-22.8,0h41.2M807.9,6V56.4m9.1,944.2c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5.1,4.1,9.2,9.1,9.2c5.1,0,9.2,-4.1,9.2,-9.2Zm-22.8,0h41.2M807.9,963.9v50.4" class="g2_355"/>
</g>
</svg></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_355" class="t s1_355">324 </span><span id="t2_355" class="t s2_355">Appendix A: Concurrency II </span>
<span id="t3_355" class="t v0_355 s3_355">01: public class Example { </span>
<span id="t4_355" class="t v0_355 s3_355">02: </span><span id="t5_355" class="t v0_355 s3_355">int lastId; </span>
<span id="t6_355" class="t v0_355 s3_355">03: </span>
<span id="t7_355" class="t v0_355 s3_355">04: </span><span id="t8_355" class="t v0_355 s3_355">public void resetId() { </span>
<span id="t9_355" class="t v0_355 s3_355">05: </span><span id="ta_355" class="t v0_355 s3_355">value = 0; </span>
<span id="tb_355" class="t v0_355 s3_355">06: </span><span id="tc_355" class="t v0_355 s3_355">} </span>
<span id="td_355" class="t v0_355 s3_355">07: </span>
<span id="te_355" class="t v0_355 s3_355">08: </span><span id="tf_355" class="t v0_355 s3_355">public int getNextId() { </span>
<span id="tg_355" class="t v0_355 s3_355">09: </span><span id="th_355" class="t v0_355 s3_355">++value; </span>
<span id="ti_355" class="t v0_355 s3_355">10: </span><span id="tj_355" class="t v0_355 s3_355">} </span>
<span id="tk_355" class="t v0_355 s3_355">11:} </span>
<span id="tl_355" class="t s1_355">What happens if we change type of </span><span id="tm_355" class="t v0_355 s3_355">lastId </span><span id="tn_355" class="t s1_355">from </span><span id="to_355" class="t v0_355 s3_355">int </span><span id="tp_355" class="t s1_355">to </span><span id="tq_355" class="t v0_355 s3_355">long</span><span id="tr_355" class="t s1_355">? Is line 5 still atomic? </span>
<span id="ts_355" class="t s1_355" data-mappings='[[30,"fi"]]'>Not according to the JVM speciﬁcation. It could be atomic on a particular processor, </span>
<span id="tt_355" class="t s1_355" data-mappings='[[30,"fi"]]'>but according to the JVM speciﬁcation, assignment to any 64-bit value requires two </span>
<span id="tu_355" class="t s1_355" data-mappings='[[48,"fi"]]'>32-bit assignments. This means that between the ﬁrst 32-bit assignment and the second </span>
<span id="tv_355" class="t s1_355">32-bit assignment, some other thread could sneak in and change one of the values. </span>
<span id="tw_355" class="t s1_355">What about the pre-increment operator, ++, on line 9? The pre-increment operator can </span>
<span id="tx_355" class="t s1_355">be interrupted, so it is not atomic. To understand, let’s review the byte-code of both of these </span>
<span id="ty_355" class="t s1_355">methods in detail. </span>
<span id="tz_355" class="t s1_355" data-mappings='[[43,"fi"]]'>Before we go any further, here are three deﬁnitions that will be important: </span>
<span id="t10_355" class="t s4_355">• </span><span id="t11_355" class="t s1_355">Frame—Every method invocation requires a frame. The frame includes the return </span>
<span id="t12_355" class="t s1_355" data-mappings='[[73,"fi"]]'>address, any parameters passed into the method and the local variables deﬁned in the </span>
<span id="t13_355" class="t s1_355" data-mappings='[[47,"fi"]]'>method. This is a standard technique used to deﬁne a call stack, which is used by </span>
<span id="t14_355" class="t s1_355">modern languages to allow for basic function/method invocation and to allow for </span>
<span id="t15_355" class="t s1_355">recursive invocation. </span>
<span id="t16_355" class="t s4_355">• </span><span id="t17_355" class="t s1_355" data-mappings='[[31,"fi"]]'>Local variable—Any variables deﬁned in the scope of the method. All nonstatic meth- </span>
<span id="t18_355" class="t s1_355">ods have at least one variable, </span><span id="t19_355" class="t v0_355 s5_355">this</span><span id="t1a_355" class="t s1_355">, which represents the current object, the object </span>
<span id="t1b_355" class="t s1_355">that received the most recent message (in the current thread), which caused the </span>
<span id="t1c_355" class="t s1_355">method invocation. </span>
<span id="t1d_355" class="t s4_355">• </span><span id="t1e_355" class="t s1_355">Operand stack—Many of the instructions in the Java Virtual Machine take parame- </span>
<span id="t1f_355" class="t s1_355">ters. The operand stack is where those parameters are put. The stack is a standard </span>
<span id="t1g_355" class="t s1_355" data-mappings='[[9,"fi"]]'>last-in, ﬁrst-out (LIFO) data structure. </span>
<span id="t1h_355" class="t s1_355">Here is the byte-code generated for </span><span id="t1i_355" class="t v0_355 s3_355">resetId()</span><span id="t1j_355" class="t s1_355">: </span>
<span id="t1k_355" class="t s2_355">Mnemonic </span><span id="t1l_355" class="t s2_355">Description </span><span id="t1m_355" class="t s2_355">Operand </span>
<span id="t1n_355" class="t s2_355">Stack After </span>
<span id="t1o_355" class="t v0_355 s3_355">ALOAD 0 </span><span id="t1p_355" class="t s1_355">Load the 0th variable onto the operand stack. </span>
<span id="t1q_355" class="t s1_355">What is the 0th variable? It is </span><span id="t1r_355" class="t v0_355 s6_355">this</span><span id="t1s_355" class="t s1_355">., the current </span>
<span id="t1t_355" class="t s1_355">object. When the method was called, the </span>
<span id="t1u_355" class="t s1_355">receiver of the message, an instance of </span><span id="t1v_355" class="t v0_355 s3_355">Example</span><span id="t1w_355" class="t s1_355">, </span>
<span id="t1x_355" class="t s1_355">was pushed into the local variable array of the </span>
<span id="t1y_355" class="t s1_355">frame created for method invocation. This is </span>
<span id="t1z_355" class="t s1_355" data-mappings='[[11,"fi"]]'>always the ﬁrst variable put in every instance </span>
<span id="t20_355" class="t s1_355">method. </span>
<span id="t21_355" class="t v0_355 s3_355">this </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
