<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta charset="utf-8" />
</head>

<body style="margin: 0;">

<div id="p354" style="overflow: hidden; position: relative; background-color: white; width: 790px; height: 1018px;">

<!-- Begin shared CSS values -->
<style class="shared-css" type="text/css" >
.t {
	transform-origin: bottom left;
	z-index: 2;
	position: absolute;
	white-space: pre;
	overflow: visible;
	line-height: 1.5;
}
.text-container {
	white-space: pre;
}
@supports (-webkit-touch-callout: none) {
	.text-container {
		white-space: normal;
	}
}
</style>
<!-- End shared CSS values -->


<!-- Begin inline CSS -->
<style type="text/css" >

#t1_354{left:648px;bottom:945px;letter-spacing:0.14px;}
#t2_354{left:120px;bottom:945px;letter-spacing:0.04px;word-spacing:0.08px;}
#t3_354{left:148px;bottom:452px;letter-spacing:0.08px;word-spacing:-0.12px;}
#t4_354{left:120px;bottom:433px;letter-spacing:0.09px;word-spacing:0.9px;}
#t5_354{left:120px;bottom:416px;letter-spacing:-0.15px;}
#t6_354{left:190px;bottom:415px;letter-spacing:0.07px;word-spacing:-0.02px;}
#t7_354{left:215px;bottom:416px;letter-spacing:-0.15px;}
#t8_354{left:241px;bottom:415px;letter-spacing:0.1px;word-spacing:-0.01px;}
#t9_354{left:120px;bottom:397px;letter-spacing:0.11px;word-spacing:0.01px;}
#ta_354{left:148px;bottom:374px;letter-spacing:0.1px;word-spacing:0.02px;}
#tb_354{left:148px;bottom:348px;letter-spacing:-0.13px;}
#tc_354{left:194px;bottom:348px;letter-spacing:-0.15px;}
#td_354{left:280px;bottom:348px;letter-spacing:-0.15px;}
#te_354{left:174px;bottom:334px;letter-spacing:-0.15px;}
#tf_354{left:148px;bottom:321px;}
#tg_354{left:120px;bottom:296px;letter-spacing:0.07px;word-spacing:1.43px;}
#th_354{left:120px;bottom:278px;letter-spacing:0.1px;}
#ti_354{left:120px;bottom:238px;letter-spacing:0.16px;}
#tj_354{left:120px;bottom:207px;letter-spacing:0.11px;word-spacing:0.39px;}
#tk_354{left:120px;bottom:189px;letter-spacing:0.03px;word-spacing:2.74px;}
#tl_354{left:187px;bottom:190px;letter-spacing:-0.15px;}
#tm_354{left:266px;bottom:189px;letter-spacing:0.09px;word-spacing:2.68px;}
#tn_354{left:120px;bottom:171px;letter-spacing:0.1px;}
#to_354{left:148px;bottom:148px;letter-spacing:0.09px;word-spacing:-0.09px;}
#tp_354{left:120px;bottom:129px;letter-spacing:0.1px;word-spacing:2.68px;}
#tq_354{left:120px;bottom:112px;letter-spacing:-0.15px;}
#tr_354{left:160px;bottom:111px;letter-spacing:0.11px;word-spacing:1.63px;}
#ts_354{left:120px;bottom:93px;letter-spacing:0.11px;}
#tt_354{left:193px;bottom:847px;letter-spacing:0.09px;word-spacing:2.22px;}
#tu_354{left:404px;bottom:847px;}
#tv_354{left:420px;bottom:847px;letter-spacing:-0.64px;}
#tw_354{left:446px;bottom:847px;}
#tx_354{left:462px;bottom:847px;letter-spacing:-0.15px;word-spacing:0.79px;}
#ty_354{left:540px;bottom:847px;}
#tz_354{left:555px;bottom:847px;letter-spacing:0.12px;}
#t10_354{left:567px;bottom:847px;letter-spacing:0.11px;word-spacing:1.82px;}
#t11_354{left:166px;bottom:828px;letter-spacing:0.1px;word-spacing:0.54px;}
#t12_354{left:356px;bottom:828px;}
#t13_354{left:370px;bottom:828px;}
#t14_354{left:381px;bottom:828px;}
#t15_354{left:394px;bottom:828px;letter-spacing:0.09px;word-spacing:0.55px;}
#t16_354{left:473px;bottom:828px;}
#t17_354{left:488px;bottom:828px;}
#t18_354{left:499px;bottom:828px;}
#t19_354{left:512px;bottom:828px;letter-spacing:0.09px;word-spacing:0.56px;}
#t1a_354{left:166px;bottom:810px;}
#t1b_354{left:171px;bottom:810px;}
#t1c_354{left:185px;bottom:810px;}
#t1d_354{left:196px;bottom:810px;}
#t1e_354{left:207px;bottom:810px;letter-spacing:0.1px;word-spacing:1.42px;}
#t1f_354{left:166px;bottom:792px;letter-spacing:0.11px;}
#t1g_354{left:375px;bottom:792px;}
#t1h_354{left:389px;bottom:792px;}
#t1i_354{left:400px;bottom:792px;}
#t1j_354{left:412px;bottom:792px;letter-spacing:0.08px;}
#t1k_354{left:193px;bottom:773px;letter-spacing:0.07px;word-spacing:0.05px;}
#t1l_354{left:166px;bottom:754px;letter-spacing:0.09px;word-spacing:3.47px;}
#t1m_354{left:166px;bottom:736px;letter-spacing:0.05px;word-spacing:-0.04px;}
#t1n_354{left:166px;bottom:718px;letter-spacing:0.1px;word-spacing:0.92px;}
#t1o_354{left:166px;bottom:699px;letter-spacing:0.11px;word-spacing:-0.09px;}
#t1p_354{left:166px;bottom:681px;letter-spacing:0.1px;word-spacing:2.16px;}
#t1q_354{left:166px;bottom:663px;letter-spacing:0.1px;}
#t1r_354{left:287px;bottom:663px;letter-spacing:0.09px;word-spacing:0.02px;}
#t1s_354{left:193px;bottom:644px;letter-spacing:0.08px;word-spacing:1.2px;}
#t1t_354{left:513px;bottom:644px;}
#t1u_354{left:527px;bottom:644px;letter-spacing:0.11px;word-spacing:0.58px;}
#t1v_354{left:579px;bottom:644px;}
#t1w_354{left:591px;bottom:644px;letter-spacing:0.1px;word-spacing:0.58px;}
#t1x_354{left:166px;bottom:625px;letter-spacing:0.09px;word-spacing:2.03px;}
#t1y_354{left:511px;bottom:625px;}
#t1z_354{left:525px;bottom:625px;letter-spacing:0.11px;word-spacing:1px;}
#t20_354{left:578px;bottom:625px;}
#t21_354{left:590px;bottom:625px;letter-spacing:0.11px;word-spacing:1px;}
#t22_354{left:166px;bottom:607px;letter-spacing:0.09px;word-spacing:0.41px;}
#t23_354{left:166px;bottom:589px;letter-spacing:0.12px;word-spacing:0.49px;}
#t24_354{left:363px;bottom:589px;}
#t25_354{left:373px;bottom:589px;letter-spacing:-0.07px;word-spacing:0.67px;}
#t26_354{left:496px;bottom:589px;}
#t27_354{left:510px;bottom:589px;letter-spacing:0.13px;word-spacing:0.48px;}
#t28_354{left:611px;bottom:589px;}
#t29_354{left:621px;bottom:589px;}
#t2a_354{left:166px;bottom:570px;letter-spacing:0.1px;word-spacing:0.01px;}
#t2b_354{left:559px;bottom:570px;}
#t2c_354{left:568px;bottom:570px;letter-spacing:0.14px;}
#t2d_354{left:584px;bottom:570px;}
#t2e_354{left:591px;bottom:570px;}
#t2f_354{left:193px;bottom:551px;letter-spacing:0.12px;word-spacing:0.75px;}
#t2g_354{left:444px;bottom:551px;}
#t2h_354{left:454px;bottom:551px;letter-spacing:0.12px;}
#t2i_354{left:474px;bottom:551px;}
#t2j_354{left:481px;bottom:551px;letter-spacing:0.12px;word-spacing:0.58px;}
#t2k_354{left:166px;bottom:533px;letter-spacing:0.1px;}
#t2l_354{left:221px;bottom:533px;}
#t2m_354{left:230px;bottom:533px;}
#t2n_354{left:237px;bottom:533px;}
#t2o_354{left:247px;bottom:533px;letter-spacing:0.09px;}
#t2p_354{left:267px;bottom:533px;}
#t2q_354{left:277px;bottom:533px;letter-spacing:0.12px;}
#t2r_354{left:297px;bottom:533px;}
#t2s_354{left:306px;bottom:533px;letter-spacing:0.09px;word-spacing:-0.27px;}
#t2t_354{left:402px;bottom:533px;}
#t2u_354{left:414px;bottom:533px;letter-spacing:0.09px;}
#t2v_354{left:442px;bottom:533px;}
#t2w_354{left:456px;bottom:533px;letter-spacing:0.08px;word-spacing:0.03px;}
#t2x_354{left:193px;bottom:514px;letter-spacing:-0.29px;}
#t2y_354{left:218px;bottom:514px;}
#t2z_354{left:232px;bottom:514px;letter-spacing:0.1px;}
#t30_354{left:281px;bottom:514px;}
#t31_354{left:293px;bottom:514px;letter-spacing:0.08px;word-spacing:0.04px;}
#t32_354{left:193px;bottom:495px;letter-spacing:-0.29px;}
#t33_354{left:218px;bottom:495px;}
#t34_354{left:232px;bottom:495px;letter-spacing:0.1px;}
#t35_354{left:281px;bottom:495px;}
#t36_354{left:293px;bottom:495px;letter-spacing:0.08px;word-spacing:0.03px;}
#t37_354{left:243px;bottom:876px;letter-spacing:0.08px;word-spacing:0.04px;}

.s1_354{font-size:15px;font-family:TimesNewRomanPS_12k;color:#2D2D2D;}
.s2_354{font-size:15px;font-family:TimesNewRomanPS-Bold_12g;color:#2D2D2D;}
.s3_354{font-size:14px;font-family:Courier_12t;color:#2D2D2D;}
.s4_354{font-size:14px;font-family:Courier-Bold_12r;color:#2D2D2D;}
.s5_354{font-size:18px;font-family:TimesNewRomanPS-Bold_12g;color:#2D2D2D;}
.s6_354{font-size:15px;font-family:TimesNewRomanPS-Italic_12p;color:#2D2D2D;}
.t.v0_354{transform:scaleX(0.8);}
</style>
<!-- End inline CSS -->

<!-- Begin embedded font definitions -->
<style id="fonts354" type="text/css" >

@font-face {
	font-family: Courier-Bold_12r;
	src: url("fonts/Courier-Bold_12r.woff") format("woff");
}

@font-face {
	font-family: Courier_12t;
	src: url("fonts/Courier_12t.woff") format("woff");
}

@font-face {
	font-family: TimesNewRomanPS-Bold_12g;
	src: url("fonts/TimesNewRomanPS-Bold_12g.woff") format("woff");
}

@font-face {
	font-family: TimesNewRomanPS-Italic_12p;
	src: url("fonts/TimesNewRomanPS-Italic_12p.woff") format("woff");
}

@font-face {
	font-family: TimesNewRomanPS_12k;
	src: url("fonts/TimesNewRomanPS_12k.woff") format("woff");
}

</style>
<!-- End embedded font definitions -->

<!-- Begin page background -->
<div id="pg354Overlay" style="width:100%; height:100%; position:absolute; z-index:1; background-color:rgba(0,0,0,0); -webkit-user-select: none;"></div>
<div id="pg354" style="-webkit-user-select: none;"><svg id="pdf354" width="790" height="1018" viewBox="0 0 790 1018" style="width:790px; height:1018px; -moz-transform:scale(1); z-index: 0; isolation: isolate;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
<clipPath id="c0_354"><path d="M-1.6,1017.1V-.1H792.5V1017.1Z"/></clipPath>
<style type="text/css"><![CDATA[
.g0_354{
fill: #C0C0C0;
}
.g1_354{
fill: none;
stroke: #2D2D2D;
stroke-width: 0.381;
stroke-miterlimit: 10;
}
.g2_354{
fill: none;
stroke: #FFF;
stroke-width: 1.145;
stroke-miterlimit: 10;
}
.g3_354{
fill: none;
stroke: #222;
stroke-width: 0.381;
stroke-miterlimit: 10;
}
]]></style>
</defs>
<path d="M643.3,224.5H147.6V149.6H643.3v74.9Z" class="g0_354"/>
<path d="M643.3,353.6H147.6V224.5H643.3V353.6Z" class="g0_354"/>
<path d="M643.3,446H147.6V353.6H643.3V446Z" class="g0_354"/>
<path d="M643.3,483.4H147.6V446H643.3v37.4Z" class="g0_354"/>
<path d="M643.3,502.5H147.6V483.4H643.3v19.1Z" class="g0_354"/>
<path d="M643.3,533.9H147.6V502.5H643.3v31.4Z" class="g0_354"/>
<path d="M643.3,149.6H147.6V111.4H643.3v38.2Z" class="g0_354"/>
<path d="M147.6,111.6V533.7M643.3,111.6V533.7M147.4,111.4H643.5M147.4,149.6H643.5M147.4,533.9H643.5" class="g1_354"/>
<g clip-path="url(#c0_354)">
<path d="M-58.2,1.4h55m-55,1017.5h55m797.4,0h55M794.2,1.4h55M10.4,-67.2v55m770,-55v55m0,1044.9v55m-770,-55v55" class="g2_354"/>
<path d="M-58.2,1.4h55m-55,1017.5h55m797.4,0h55M794.2,1.4h55M10.4,-67.2v55m770,-55v55m0,1044.9v55m-770,-55v55M-7.8,510.2c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5,4.1,9.1,9.1,9.1c5.1,0,9.2,-4.1,9.2,-9.1Zm-36.7,0H-3.2M-17,473.5v73.3M817,510.2c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5,4.1,9.1,9.1,9.1c5.1,0,9.2,-4.1,9.2,-9.1Zm-22.8,0h41.2M807.9,473.5v73.3M-7.8,19.8c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5,4.1,9.1,9.1,9.1c5.1,0,9.2,-4.1,9.2,-9.1Zm-36.7,0H-3.2M-17,6V56.4m9.2,944.2c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5.1,4.1,9.2,9.1,9.2c5.1,0,9.2,-4.1,9.2,-9.2Zm-36.7,0H-3.2M-17,963.9v50.4M817,19.8c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5,4.1,9.1,9.1,9.1c5.1,0,9.2,-4.1,9.2,-9.1Zm-22.8,0h41.2M807.9,6V56.4m9.1,944.2c0,-5.1,-4.1,-9.2,-9.2,-9.2c-5,0,-9.1,4.1,-9.1,9.2c0,5.1,4.1,9.2,9.1,9.2c5.1,0,9.2,-4.1,9.2,-9.2Zm-22.8,0h41.2M807.9,963.9v50.4" class="g3_354"/>
</g>
</svg></div>
<!-- End page background -->


<!-- Begin text definitions (Positioned/styled in CSS) -->
<div class="text-container"><span id="t1_354" class="t s1_354">323 </span><span id="t2_354" class="t s2_354">Possible Paths of Execution </span>
<span id="t3_354" class="t s1_354">For our simple case of one line of Java code, which equates to eight lines of byte-code </span>
<span id="t4_354" class="t s1_354">and two threads, the total number of possible paths of execution is 12,870. If the type of </span>
<span id="t5_354" class="t v0_354 s3_354">lastIdUsed </span><span id="t6_354" class="t s1_354">is a </span><span id="t7_354" class="t v0_354 s3_354">long</span><span id="t8_354" class="t s1_354">, then every read/write becomes two operations instead of one, and the </span>
<span id="t9_354" class="t s1_354">number of possible orderings becomes 2,704,156. </span>
<span id="ta_354" class="t s1_354">What happens if we make one change to this method? </span>
<span id="tb_354" class="t v0_354 s3_354">public </span><span id="tc_354" class="t v0_354 s4_354">synchronized </span><span id="td_354" class="t v0_354 s3_354">void incrementValue() { </span>
<span id="te_354" class="t v0_354 s3_354">++lastIdUsed; </span>
<span id="tf_354" class="t v0_354 s3_354">} </span>
<span id="tg_354" class="t s1_354">The number of possible execution pathways becomes two for two threads and N! in the </span>
<span id="th_354" class="t s1_354">general case. </span>
<span id="ti_354" class="t s5_354">Digging Deeper </span>
<span id="tj_354" class="t s1_354">What about the surprising result that two threads could both call the method once (before </span>
<span id="tk_354" class="t s1_354">we added </span><span id="tl_354" class="t v0_354 s3_354">synchronized</span><span id="tm_354" class="t s1_354">) and get the same numeric result? How is that possible? First </span>
<span id="tn_354" class="t s1_354" data-mappings='[[7,"fi"]]'>things ﬁrst. </span>
<span id="to_354" class="t s1_354" data-mappings='[[38,"fi"]]'>What is an atomic operation? We can deﬁne an atomic operation as any operation that </span>
<span id="tp_354" class="t s1_354">is uninterruptable. For example, in the following code, line 5, where 0 is assigned to </span>
<span id="tq_354" class="t v0_354 s3_354">lastid</span><span id="tr_354" class="t s1_354">, is atomic because according to the Java Memory model, assignment to a 32-bit </span>
<span id="ts_354" class="t s1_354">value is uninterruptable. </span>
<span id="tt_354" class="t s1_354">So we want the permutations of </span><span id="tu_354" class="t s6_354">N </span><span id="tv_354" class="t s1_354">1’s, </span><span id="tw_354" class="t s6_354">N </span><span id="tx_354" class="t s1_354">2’s, . . . and </span><span id="ty_354" class="t s6_354">N </span><span id="tz_354" class="t s6_354">T’ </span><span id="t10_354" class="t s1_354">s. This is </span>
<span id="t11_354" class="t s1_354">really just the permutations of </span><span id="t12_354" class="t s6_354">N </span><span id="t13_354" class="t s1_354">* </span><span id="t14_354" class="t s6_354">T </span><span id="t15_354" class="t s1_354">things taken </span><span id="t16_354" class="t s6_354">N </span><span id="t17_354" class="t s1_354">* </span><span id="t18_354" class="t s6_354">T </span><span id="t19_354" class="t s1_354">at a time, which is </span>
<span id="t1a_354" class="t s1_354">(</span><span id="t1b_354" class="t s6_354">N </span><span id="t1c_354" class="t s1_354">* </span><span id="t1d_354" class="t s6_354">T </span><span id="t1e_354" class="t s1_354">)!, but with all the duplicates removed. So the trick is to count the </span>
<span id="t1f_354" class="t s1_354">duplicates and subtract that from (</span><span id="t1g_354" class="t s6_354">N </span><span id="t1h_354" class="t s1_354">* </span><span id="t1i_354" class="t s6_354">T </span><span id="t1j_354" class="t s1_354">)!. </span>
<span id="t1k_354" class="t s1_354">Given two steps and two threads, how many duplicates are there? Each </span>
<span id="t1l_354" class="t s1_354">four-digit string has two 1s and two 2s. Each of those pairs could be </span>
<span id="t1m_354" class="t s1_354">swapped without changing the sense of the string. You could swap the 1s or </span>
<span id="t1n_354" class="t s1_354">the 2s both, or neither. So there are four isomorphs for each string, which </span>
<span id="t1o_354" class="t s1_354">means that there are three duplicates. So three out of four of the options are </span>
<span id="t1p_354" class="t s1_354">duplicates; alternatively one of four of the permutations are NOT dupli- </span>
<span id="t1q_354" class="t s1_354">cates. 4! * .25 = 6. </span><span id="t1r_354" class="t s1_354">So this reasoning seems to work. </span>
<span id="t1s_354" class="t s1_354">How many duplicates are there? In the case where </span><span id="t1t_354" class="t s6_354">N </span><span id="t1u_354" class="t s1_354">= 2 and </span><span id="t1v_354" class="t s6_354">T </span><span id="t1w_354" class="t s1_354">= 2, I </span>
<span id="t1x_354" class="t s1_354">could swap the 1s, the 2s, or both. In the case where </span><span id="t1y_354" class="t s6_354">N </span><span id="t1z_354" class="t s1_354">= 2 and </span><span id="t20_354" class="t s6_354">T </span><span id="t21_354" class="t s1_354">= 3, I </span>
<span id="t22_354" class="t s1_354">could swap the 1s, the 2s, the 3s, 1s and 2s, 1s and 3s, or 2s and 3s. Swap- </span>
<span id="t23_354" class="t s1_354">ping is just the permutations of </span><span id="t24_354" class="t s6_354">N</span><span id="t25_354" class="t s1_354">. Let’s say there are </span><span id="t26_354" class="t s6_354">P </span><span id="t27_354" class="t s1_354">permutations of </span><span id="t28_354" class="t s6_354">N</span><span id="t29_354" class="t s1_354">. </span>
<span id="t2a_354" class="t s1_354">The number of different ways to arrange those permutations are </span><span id="t2b_354" class="t s6_354">P</span><span id="t2c_354" class="t s1_354">**</span><span id="t2d_354" class="t s6_354">T </span><span id="t2e_354" class="t s1_354">. </span>
<span id="t2f_354" class="t s1_354">So the number of possible isomorphs is </span><span id="t2g_354" class="t s6_354">N</span><span id="t2h_354" class="t s1_354">!**</span><span id="t2i_354" class="t s6_354">T </span><span id="t2j_354" class="t s1_354">. And so the number of </span>
<span id="t2k_354" class="t s1_354">paths is (</span><span id="t2l_354" class="t s6_354">T</span><span id="t2m_354" class="t s1_354">*</span><span id="t2n_354" class="t s6_354">N</span><span id="t2o_354" class="t s1_354">)!/(</span><span id="t2p_354" class="t s6_354">N</span><span id="t2q_354" class="t s1_354">!**</span><span id="t2r_354" class="t s6_354">T</span><span id="t2s_354" class="t s1_354">). Again, in our </span><span id="t2t_354" class="t s6_354">T </span><span id="t2u_354" class="t s1_354">= 2, </span><span id="t2v_354" class="t s6_354">N </span><span id="t2w_354" class="t s1_354">= 2 case we get 6 (24/4). </span>
<span id="t2x_354" class="t s1_354">For </span><span id="t2y_354" class="t s6_354">N </span><span id="t2z_354" class="t s1_354">= 2 and </span><span id="t30_354" class="t s6_354">T </span><span id="t31_354" class="t s1_354">= 3 we get 720/8 = 90. </span>
<span id="t32_354" class="t s1_354">For </span><span id="t33_354" class="t s6_354">N </span><span id="t34_354" class="t s1_354">= 3 and </span><span id="t35_354" class="t s6_354">T </span><span id="t36_354" class="t s1_354">= 3 we get 9!/6^3 = 1680. </span>
<span id="t37_354" class="t s2_354">Calculating the Possible Orderings (continued) </span></div>
<!-- End text definitions -->


</div>
</body>
</html>
